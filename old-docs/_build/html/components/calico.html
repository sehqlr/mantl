<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Calico &mdash; Mantl 1.0.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Mantl 1.0.3 documentation" href="../index.html" />
    <link rel="up" title="Components" href="index.html" />
    <link rel="next" title="Chronos" href="chronos.html" />
    <link rel="prev" title="Components" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="chronos.html" title="Chronos"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Components"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Mantl 1.0.3 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Components</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="calico">
<h1>Calico<a class="headerlink" href="#calico" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.4.</span></p>
</div>
<p><a class="reference external" href="https://www.projectcalico.org">Calico</a> is used in the project to add the IP
per container functionality. Calico connects Docker containers through IP no matter
which worker node they are on. Calico uses <a class="reference internal" href="etcd.html"><em>etcd</em></a> to distribute information
about workloads, endpoints, and policy to each worker node. Endpoints are
network interfaces associated with workloads. Calico is deployed in the Docker
container on each worker node and managed by systemd. Any workload managed by
Calico is registered as a service in Consul.</p>
<p>Calico is not enabled by default. In order to run Calico, you should make a
couple of changes to your <tt class="docutils literal"><span class="pre">mantl.yml</span></tt>. You will need to add the <tt class="docutils literal"><span class="pre">etcd</span></tt>
role into the <tt class="docutils literal"><span class="pre">roles</span></tt> section for <tt class="docutils literal"><span class="pre">all</span></tt> hosts:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span>- hosts: all
  ...
  roles:
    - common
    ...
    - etcd
</pre></div>
</div>
<p>And you need to add the <tt class="docutils literal"><span class="pre">calico</span></tt> role to the <tt class="docutils literal"><span class="pre">role=worker</span></tt> hosts:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span>- hosts: role=worker
  roles:
    ...
    - calico
</pre></div>
</div>
<div class="section" id="modes">
<h2>Modes<a class="headerlink" href="#modes" title="Permalink to this headline">¶</a></h2>
<p>Calico can run a public cloud environment that does not allow either L3 peering
or L2 connectivity between Calico hosts. Calico will then route traffic between
the Calico hosts using IP in IP mode. At this time, the full node-to-node BGP
mesh is supported and configured in OpenStack only. Other cloud environments
are set up with the IP in IP mode.</p>
</div>
<div class="section" id="mesos">
<h2>Mesos<a class="headerlink" href="#mesos" title="Permalink to this headline">¶</a></h2>
<p>We pass the environment variable <tt class="docutils literal"><span class="pre">DOCKER_HOST</span></tt> to the executor using the
flag <tt class="docutils literal"><span class="pre">--executor_environment_variables</span></tt> (added in Mesos v0.23.0), and thus
the subsequent tasks:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;DOCKER_HOST&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost:2377&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This allows Calico to set up networking automatically by routing Docker API
requests through the <a class="reference external" href="https://github.com/clusterhq/powerstrip">Powerstrip</a>
proxy that is running on port <tt class="docutils literal"><span class="pre">2377</span></tt> on each Mesos slave host.</p>
</div>
<div class="section" id="marathon">
<h2>Marathon<a class="headerlink" href="#marathon" title="Permalink to this headline">¶</a></h2>
<p>When you start containers on top of Marathon, you will need to add two
environment variables to your JSON file: <tt class="docutils literal"><span class="pre">CALICO_IP</span></tt> and <tt class="docutils literal"><span class="pre">CALICO_PROFILE</span></tt>.
You can assign an IP address to <tt class="docutils literal"><span class="pre">CALICO_IP</span></tt> explicitly or set <tt class="docutils literal"><span class="pre">auto</span></tt> and it
will be allocated automatically. If the profile set with <tt class="docutils literal"><span class="pre">CALICO_PROFILE</span></tt>
doesn&#8217;t exist, it will be created automatically. If you don&#8217;t provide the two
variables, the Docker default network settings will be applied. The variable
<tt class="docutils literal"><span class="pre">SERVICE_PORT</span></tt> is optional, it registers a service port in Consul for your
application. You can make an SRV query to return this port.</p>
<p>Example:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DOCKER&quot;</span><span class="p">,</span>
    <span class="nt">&quot;docker&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;busybox&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;testapp&quot;</span><span class="p">,</span>
  <span class="nt">&quot;instances&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;CALICO_IP&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="nt">&quot;CALICO_PROFILE&quot;</span><span class="p">:</span> <span class="s2">&quot;dev&quot;</span><span class="p">,</span>
    <span class="nt">&quot;SERVICE_PORT&quot;</span><span class="p">:</span> <span class="s2">&quot;3000&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
  <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
  <span class="nt">&quot;uris&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;while sleep 10; do date -u +%T; done&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="consul">
<h2>Consul<a class="headerlink" href="#consul" title="Permalink to this headline">¶</a></h2>
<p>When you start a workload on Marathon with the proper environment variables
as <tt class="docutils literal"><span class="pre">CALICO_IP</span></tt> and <tt class="docutils literal"><span class="pre">CALICO_PROFILE</span></tt>, the workload is registered in Consul
as a service. The Powerstrip logic was extended in this case.
The registered name is constructed in this way: <tt class="docutils literal"><span class="pre">MARATHON_APP_ID</span></tt> plus
<tt class="docutils literal"><span class="pre">-direct</span></tt> suffix. For example, if you create a workload with the name of
<tt class="docutils literal"><span class="pre">testapp</span></tt>, then the <tt class="docutils literal"><span class="pre">testapp-direct</span></tt> service will be registered in Consul.</p>
<p>Thus, you have the option to query Consul in two ways:</p>
<ol class="arabic simple">
<li>In order to obtain Docker host IP addresses where your workload is running:</li>
</ol>
<div class="highlight-shell"><div class="highlight"><pre><span></span>dig @localhost -p <span class="m">8600</span> testapp.service.consul
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>To resolve IP addresses from the Calico network:</li>
</ol>
<div class="highlight-shell"><div class="highlight"><pre><span></span>dig @localhost -p <span class="m">8600</span> testapp-direct.service.consul
</pre></div>
</div>
<p>In the above examples, adjust the <cite>.consul</cite> domain as needed if you customized
it when building your cluster.</p>
</div>
<div class="section" id="calicoctl">
<h2>calicoctl<a class="headerlink" href="#calicoctl" title="Permalink to this headline">¶</a></h2>
<p>You can use the <tt class="docutils literal"><span class="pre">calicoctl</span></tt> command line tool to manually configure and start
the Calico services, interact with the etcd datastore, define and apply network
and security policies, and other.</p>
<p>Examples:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>calicoctl <span class="nb">help</span>
calicoctl status
calicoctl profile show --detailed
calicoctl endpoint show --detailed
calicoctl pool show
</pre></div>
</div>
</div>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>All components log to directories under <tt class="docutils literal"><span class="pre">/var/log/calico</span></tt> inside
the calico-docker container. By default this is mapped to
the <tt class="docutils literal"><span class="pre">/var/log/calico</span></tt> directory on the host. Files are automatically rotated,
and by default 10 files of 1MB each are kept.</p>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>You can use these variables to customize your Calico installation. For more
information, refer to the <a class="reference internal" href="etcd.html"><em>etcd</em></a> configuration.</p>
<dl class="data">
<dt id="etcd_service_name">
<tt class="descname">etcd_service_name</tt><a class="headerlink" href="#etcd_service_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the <tt class="docutils literal"><span class="pre">ETCD_AUTHORITY</span></tt> environment variable that is used by Calico Docker
container and the CLI tool <tt class="docutils literal"><span class="pre">calicoctl</span></tt>. The value of this variable is
a Consul service that must be resolved through DNS</p>
<p>Default: <tt class="docutils literal"><span class="pre">etcd.service.consul</span></tt></p>
</dd></dl>

<dl class="data">
<dt id="etcd_client_port">
<tt class="descname">etcd_client_port</tt><a class="headerlink" href="#etcd_client_port" title="Permalink to this definition">¶</a></dt>
<dd><p>Port for etcd client communication</p>
<p>Default: <tt class="docutils literal"><span class="pre">2379</span></tt></p>
</dd></dl>

<dl class="data">
<dt id="calico_network">
<tt class="descname">calico_network</tt><a class="headerlink" href="#calico_network" title="Permalink to this definition">¶</a></dt>
<dd><p>Containers are assigned IPs from this network range</p>
<p>Default: <tt class="docutils literal"><span class="pre">192.168.0.0/16</span></tt></p>
</dd></dl>

<dl class="data">
<dt id="calico_profile">
<tt class="descname">calico_profile</tt><a class="headerlink" href="#calico_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Endpoints are added to this profile for interconnectivity</p>
<p>Default: <tt class="docutils literal"><span class="pre">dev</span></tt></p>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/cisco.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Mantl</h2>
    
  </a>
</p>





<p>
<iframe src="http://ghbtns.com/github-btn.html?user=ciscocloud&repo=mantl&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html#general-information-about-mantl-with-ansible">General Information about Mantl with Ansible</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Components</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Calico</a></li>
<li class="toctree-l2"><a class="reference internal" href="chronos.html">Chronos</a></li>
<li class="toctree-l2"><a class="reference internal" href="collectd.html">Collectd</a></li>
<li class="toctree-l2"><a class="reference internal" href="consul.html">Consul</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributive.html">Distributive</a></li>
<li class="toctree-l2"><a class="reference internal" href="dnsmasq.html">dnsmasq</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="elk.html">ELK</a></li>
<li class="toctree-l2"><a class="reference internal" href="etcd.html">etcd</a></li>
<li class="toctree-l2"><a class="reference internal" href="glusterfs.html">GlusterFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="haproxy.html">Haproxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="kafka.html">Kafka</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="logstash.html">Logstash</a></li>
<li class="toctree-l2"><a class="reference internal" href="marathon.html">Marathon</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesos.html">Mesos</a></li>
<li class="toctree-l2"><a class="reference internal" href="traefik.html">Traefik</a></li>
<li class="toctree-l2"><a class="reference internal" href="zookeeper.html">ZooKeeper</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html">Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="consul-template.html">consul-template</a></li>
<li class="toctree-l2"><a class="reference internal" href="logrotate.html">logrotate</a></li>
<li class="toctree-l2"><a class="reference internal" href="nginx.html">Nginx</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html">Vault</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../addons.html">Addons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packer.html">Packer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Licenses</a></li>
</ul>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Cisco Systems, Incorporated.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.2.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.6.3</a>
      
      |
      <a href="../_sources/components/calico.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>