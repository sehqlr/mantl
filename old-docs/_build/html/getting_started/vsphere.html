<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>VMware vSphere &mdash; Mantl 1.0.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Mantl 1.0.3 documentation" href="../index.html" />
    <link rel="up" title="Getting Started" href="index.html" />
    <link rel="next" title="SoftLayer" href="softlayer.html" />
    <link rel="prev" title="DigitalOcean" href="digitalocean.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="softlayer.html" title="SoftLayer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="digitalocean.html" title="DigitalOcean"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Mantl 1.0.3 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Getting Started</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="vmware-vsphere">
<h1>VMware vSphere<a class="headerlink" href="#vmware-vsphere" title="Permalink to this headline">¶</a></h1>
<p>You can bring up VMware vSphere environment using Terraform with builtin vSphere provider.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="section" id="terraform">
<h3>Terraform<a class="headerlink" href="#terraform" title="Permalink to this headline">¶</a></h3>
<p>Install Terraform according to the <a class="reference external" href="https://www.terraform.io/intro/getting-started/install.html">guide</a>.</p>
<p><em>Note: Minimum Terraform version of 0.6.16 required to leverage some newer features of the vSphere provider</em></p>
</div>
<div class="section" id="vmware-template">
<h3>VMware template<a class="headerlink" href="#vmware-template" title="Permalink to this headline">¶</a></h3>
<p>Create <a class="reference external" href="https://pubs.vmware.com/vsphere-50/index.jsp?topic=%2Fcom.vmware.vsphere.vm_admin.doc_50%2FGUID-40BC4243-E4FA-4A46-8C8B-F50D92C186ED.html">VMware template</a> for microservices cluster. You will able to change CPU and RAM parameters while provisioning a virtual machine from template with Terraform. It&#8217;s recommended to disable SELinux. Create user and add public RSA keys for SSH into the $HOME/.ssh/authorized_keys.
It is required to have VMware tools in the template, because we need to populate resulting <tt class="docutils literal"><span class="pre">.tfstate</span></tt> file with IP addresses of provisioned machines.
This configuration was tested on CentOS 7.1 x64.</p>
</div>
</div>
<div class="section" id="configuring-vsphere-for-terraform">
<h2>Configuring vSphere for Terraform<a class="headerlink" href="#configuring-vsphere-for-terraform" title="Permalink to this headline">¶</a></h2>
<div class="section" id="provider-settings">
<h3>Provider settings<a class="headerlink" href="#provider-settings" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">vsphere_server</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt> are the required parameters needed by Terraform to interact with resources in your vSphere.
<tt class="docutils literal"><span class="pre">allow_unverified_ssl</span></tt> parameter is reponsible for checking SSL certificates of the vCenter. If you have self-signed certificates it is necessary to set this parameter to <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
<dl class="envvar">
<dt id="envvar-VSPHERE_USER">
<tt class="descname">VSPHERE_USER</tt><a class="headerlink" href="#envvar-VSPHERE_USER" title="Permalink to this definition">¶</a></dt>
<dd><p>The vSphere username with the necessary permissions.</p>
</dd></dl>

<dl class="envvar">
<dt id="envvar-VSPHERE_PASSWORD">
<tt class="descname">VSPHERE_PASSWORD</tt><a class="headerlink" href="#envvar-VSPHERE_PASSWORD" title="Permalink to this definition">¶</a></dt>
<dd><p>The password of the user.</p>
</dd></dl>

</div>
<div class="section" id="basic-settings">
<h3>Basic settings<a class="headerlink" href="#basic-settings" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">datacenter</span></tt> is the name of datacenter in your vSphere environment. It is required if the vSphere has several datacenters.</p>
<p><tt class="docutils literal"><span class="pre">cluster</span></tt> is the name of the cluster in the selected datacenter. It&#8217;s an optional parameter.</p>
<p><tt class="docutils literal"><span class="pre">pool</span></tt> is the name of resource pool in vSphere. It&#8217;s an optional parameter.  Requires full path to Pool such as Cluster_Name/Resources/Pool_Name</p>
<p><tt class="docutils literal"><span class="pre">template</span></tt> is the name of a base VM or template you will deploy you machines from. Should include a path in VM folder hierarchy: <tt class="docutils literal"><span class="pre">folder/subfolder/vm-name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">network_label</span></tt> is the label of the network assigned to the machines.</p>
<p><tt class="docutils literal"><span class="pre">domain</span></tt> is the domain name to configure each host with.</p>
<p><tt class="docutils literal"><span class="pre">dns_server1</span></tt> &amp; <tt class="docutils literal"><span class="pre">dns_server2</span></tt> are the dns servers to configure on the hosts.</p>
<p><tt class="docutils literal"><span class="pre">short_name</span></tt> is the prefix that will be used for the new virtual machines.</p>
<p><tt class="docutils literal"><span class="pre">ssh_user</span></tt> is the username for the further service provisioning. This user has to be in the sudoers group with NOPASSWD option.</p>
<p><tt class="docutils literal"><span class="pre">ssh_key</span></tt> is the path to the SSH private key.</p>
<p><tt class="docutils literal"><span class="pre">control_volume_size</span></tt> is the size in GB to create the data drive for the control nodes</p>
<p><tt class="docutils literal"><span class="pre">worker_volume_size</span></tt> is the size in GB to create the data drive for the worker nodes</p>
<p><tt class="docutils literal"><span class="pre">edge_volume_size</span></tt> is the size in GB to create the data drive for the edge nodes</p>
<p><tt class="docutils literal"><span class="pre">datastore</span></tt> is the name of the datastore to create the use for the new VMs</p>
</div>
<div class="section" id="microservices-settings">
<h3>Microservices settings<a class="headerlink" href="#microservices-settings" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">control_count</span></tt> and <tt class="docutils literal"><span class="pre">worker_count</span></tt> are the number of nodes for specific roles.</p>
<p><tt class="docutils literal"><span class="pre">consul_dc</span></tt> the name of datacenter for Consul configuration.</p>
</div>
<div class="section" id="optional-settings">
<h3>Optional settings<a class="headerlink" href="#optional-settings" title="Permalink to this headline">¶</a></h3>
<p>There are several optional settings that can be leveraged in the sample terraform file.  Just uncomment the line and configure the desired value.</p>
<p><tt class="docutils literal"><span class="pre">folder</span></tt> set this to the name of a folder to place the new virtual machines into under the Datacenter object.  Folder must exist already.</p>
<p><tt class="docutils literal"><span class="pre">control_cpu</span></tt> is the number of vCPUs to deploy for control nodes.</p>
<p><tt class="docutils literal"><span class="pre">worker_cpu</span></tt> is the number of vCPUs to deploy for worker nodes.</p>
<p><tt class="docutils literal"><span class="pre">edge_cpu</span></tt> is the number of vCPUs to deploy for edge nodes.</p>
<p><tt class="docutils literal"><span class="pre">control_ram</span></tt> is the amount of vRAM in MBs to deploy for control nodes.</p>
<p><tt class="docutils literal"><span class="pre">worker_ram</span></tt> is the number of vRAM in MBs to deploy for worker nodes.</p>
<p><tt class="docutils literal"><span class="pre">edge_ram</span></tt> is the number of vRAM in MBs to deploy for edge nodes.</p>
<p><tt class="docutils literal"><span class="pre">linked_clone</span></tt> setting this to true will deploy the VMs as linked clones.  Default of false will create standard full clones for each VM.  Note that performance of linked clones is dependent on the underlying servers and storage.  In some cases linked_clone deployments have failed during installation where full clones work fine.  If you get errors during the installation on a linked_clone setup, try using full clones and see if that fixes the error.</p>
</div>
<div class="section" id="advanced-settings">
<h3>Advanced settings<a class="headerlink" href="#advanced-settings" title="Permalink to this headline">¶</a></h3>
<p>You also can change advanced settings in module file <tt class="docutils literal"><span class="pre">terraform/vsphere/main.tf</span></tt></p>
<p><tt class="docutils literal"><span class="pre">configuration_parameters</span></tt> are the custom parameters, for example specific service <tt class="docutils literal"><span class="pre">role</span></tt>.</p>
</div>
</div>
<div class="section" id="provisioning">
<h2>Provisioning<a class="headerlink" href="#provisioning" title="Permalink to this headline">¶</a></h2>
<p>Once you&#8217;re all set up with the provider, customize your module, run <tt class="docutils literal"><span class="pre">terraform</span> <span class="pre">get</span></tt> to prepare Terraform to provision your cluster, <tt class="docutils literal"><span class="pre">terraform</span> <span class="pre">plan</span></tt> to see what will be created, and <tt class="docutils literal"><span class="pre">terraform</span> <span class="pre">apply</span></tt> to provision the cluster. At the end of provisioning Terraform will perform commands to change hostnames for correct service work. You can change this behavior in the <tt class="docutils literal"><span class="pre">provisioner</span></tt> section for each resource in the <tt class="docutils literal"><span class="pre">terraform/vsphere/main.tf</span></tt> file.
Due to a timing condition when requesting a MAC address from the vsphere server (<tt class="docutils literal"><span class="pre">ethernet0.addressType</span> <span class="pre">=</span> <span class="pre">&quot;vpx&quot;</span></tt>) you may have to apply without the provisioner for a first time and issue <tt class="docutils literal"><span class="pre">terraform</span> <span class="pre">apply</span></tt> (with provisioner) afterwards. This will allow the guest tools to provide the IP addresses.</p>
<p>Afterwards, you can
use the instructions in <a class="reference internal" href="index.html"><em>getting started</em></a> to install
Mantl on your new cluster.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/cisco.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Mantl</h2>
    
  </a>
</p>





<p>
<iframe src="http://ghbtns.com/github-btn.html?user=ciscocloud&repo=mantl&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html#general-information-about-mantl-with-ansible">General Information about Mantl with Ansible</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#preparing-to-provision-cloud-hosts">Preparing to provision Cloud Hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#deploying-software-via-ansible">Deploying software via Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#checking-your-deployment">Checking your deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addons.html">Addons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packer.html">Packer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Licenses</a></li>
</ul>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Cisco Systems, Incorporated.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.2.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.6.3</a>
      
      |
      <a href="../_sources/getting_started/vsphere.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>