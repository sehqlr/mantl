<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DNS &mdash; Mantl 1.0.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Mantl 1.0.3 documentation" href="../index.html" />
    <link rel="up" title="Google Compute Engine" href="gce.html" />
    <link rel="next" title="CloudFlare" href="cloudflare.html" />
    <link rel="prev" title="Google Compute Engine" href="gce.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cloudflare.html" title="CloudFlare"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gce.html" title="Google Compute Engine"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Mantl 1.0.3 documentation</a> &raquo;</li>
          <li><a href="index.html" >Getting Started</a> &raquo;</li>
          <li><a href="dockerfile.html" >Using the Dockerfile</a> &raquo;</li>
          <li><a href="gce.html" accesskey="U">Google Compute Engine</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="dns">
<h1>DNS<a class="headerlink" href="#dns" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.3.</span></p>
</div>
<p>Terraform lets you configure DNS for your instances. The DNS provider is loosely
coupled from the server provider, so you could for example use the dnsimple
provider for either OpenStack or AWS hosts, or use the Google Cloud DNS provider
for DigitalOcean hosts.</p>
<div class="section" id="providers">
<h2>Providers<a class="headerlink" href="#providers" title="Permalink to this headline">¶</a></h2>
<p>These are the supported DNS providers:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="cloudflare.html">CloudFlare</a></li>
<li class="toctree-l1"><a class="reference internal" href="dnsimple.html">DNSimple</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouddns.html">GCP Cloud DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="route53.html">Route53</a></li>
</ul>
</div>
<div class="section" id="dns-records-and-configuration">
<h3>DNS Records and Configuration<a class="headerlink" href="#dns-records-and-configuration" title="Permalink to this headline">¶</a></h3>
<p>The providers create a uniform set of DNS A records:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">{short-name}-control-{nn}.node{subdomain}.{domain}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">{short-name}-edge-{nn}.node{subdomain}.{domain}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">{short-name}-worker-{nnn}.node{subdomain}.{domain}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">{control}{subdomain}.{domain}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">*.{subdomain}.{domain}</span></tt></li>
</ul>
<p>For example, with <tt class="docutils literal"><span class="pre">short-name=mantl</span></tt>, <tt class="docutils literal"><span class="pre">domain=example.com</span></tt>, a blank
subdomain, 3 control nodes, 4 worker nodes, 2 Kubernetes worker nodes, and 2
edge nodes, that will give us these DNS records:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">mantl-control-01.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-control-02.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-control-03.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-worker-001.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-worker-002.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-worker-003.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-worker-004.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-kubeworker-001.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-kubeworker-002.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-edge-01.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">mantl-edge-02.node.example.com</span></tt></li>
<li><tt class="docutils literal"><span class="pre">control.example.com</span></tt> (pointing to control 1)</li>
<li><tt class="docutils literal"><span class="pre">control.example.com</span></tt> (pointing to control 2)</li>
<li><tt class="docutils literal"><span class="pre">control.example.com</span></tt> (pointing to control 3)</li>
<li><tt class="docutils literal"><span class="pre">*.example.com</span></tt> (pointing to edge node load balancer)</li>
</ul>
<p>If you don&#8217;t want the DNS records hanging off the apex, you can specify the
<tt class="docutils literal"><span class="pre">subdomain</span></tt> parameter to the DNS providers, which will be inserted in the
records just before the apex. For example, if <tt class="docutils literal"><span class="pre">subdomain=.mantl</span></tt> in the
previous config, the wildcard records would be <tt class="docutils literal"><span class="pre">*.mantl.example.com</span></tt>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Due to a limitation in Terraform&#8217;s string support, the subdomain <em>must</em> begin
with a period (for example <tt class="docutils literal"><span class="pre">.mantl</span></tt>).</p>
</div>
<p>The node records are intended to be used to access each node individually for
maintenance. You can access the frontend web components of the Mantl cluster
through <tt class="docutils literal"><span class="pre">control.example.com</span></tt>, which will direct you to the rest of the stack.</p>
<p>You can use the wildcard records for load-balanced access to any app in
Marathon. For example, if you have an app named <tt class="docutils literal"><span class="pre">test</span></tt> running in Marathon,
you can access it at <tt class="docutils literal"><span class="pre">test.example.com</span></tt>. Please see the
<a class="reference internal" href="../components/traefik.html"><em>Traefik</em></a> configuration for more details.</p>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>A good way to configure DNS is to move the values common to your cloud config
and DNS config into separate variables. You can do that like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">variable</span> <span class="nx">control_count</span> <span class="p">{</span> <span class="k">default</span> <span class="o">=</span> <span class="mi">3</span> <span class="p">}</span>
<span class="nx">variable</span> <span class="nx">worker_count</span> <span class="p">{</span> <span class="k">default</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">}</span>
<span class="nx">variable</span> <span class="nx">kubeworker_count</span> <span class="p">{</span> <span class="k">default</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">}</span>
<span class="nx">variable</span> <span class="nx">edge_count</span> <span class="p">{</span> <span class="k">default</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">}</span>
<span class="nx">variable</span> <span class="nx">short_name</span> <span class="p">{</span> <span class="k">default</span> <span class="o">=</span> <span class="s2">&quot;mantl&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Then use those variables in the module like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">module</span> <span class="s2">&quot;dns&quot;</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">&quot;./terraform/cloudflare&quot;</span>

  <span class="nx">control_count</span> <span class="o">=</span> <span class="s2">&quot;${var.control_count}&quot;</span>
  <span class="nx">control_ips</span> <span class="o">=</span> <span class="s2">&quot;${module.do-hosts.control_ips}&quot;</span>
  <span class="nx">domain</span> <span class="o">=</span> <span class="s2">&quot;mantl.io&quot;</span>
  <span class="nx">edge_count</span> <span class="o">=</span> <span class="s2">&quot;${var.edge_count}&quot;</span>
  <span class="nx">edge_ips</span> <span class="o">=</span> <span class="s2">&quot;${module.do-hosts.edge_ips}&quot;</span>
  <span class="nx">short_name</span> <span class="o">=</span> <span class="s2">&quot;${var.short_name}&quot;</span>
  <span class="nx">subdomain</span> <span class="o">=</span> <span class="s2">&quot;.do.test&quot;</span>
  <span class="nx">worker_count</span> <span class="o">=</span> <span class="s2">&quot;${var.worker_count}&quot;</span>
  <span class="nx">worker_ips</span> <span class="o">=</span> <span class="s2">&quot;${module.do-hosts.worker_ips}&quot;</span>
  <span class="nx">kubeworker_count</span> <span class="o">=</span> <span class="s2">&quot;${var.kubeworker_count}&quot;</span>
  <span class="nx">kubeworker_ips</span> <span class="o">=</span> <span class="s2">&quot;${module.do-hosts.kubeworker_ips}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-variables">
<h3>Configuration Variables<a class="headerlink" href="#configuration-variables" title="Permalink to this headline">¶</a></h3>
<p>Configuration is done with a set of consistent variables across the providers:</p>
<dl class="data">
<dt>
<tt class="descname">control_count, worker_count, kubeworker_count, and edge_count</tt></dt>
<dd><p>The count of nodes for each role.</p>
</dd></dl>

<dl class="data">
<dt>
<tt class="descname">control_ips, worker_ips, kubeworker_ips, and edge_ips</tt></dt>
<dd><p>A comma-separated list of IPs. The cloud provider modules all export this as
<tt class="docutils literal"><span class="pre">control_ips</span></tt>, <tt class="docutils literal"><span class="pre">worker_ips</span></tt>, <tt class="docutils literal"><span class="pre">kubeworker_ips</span></tt>, and <tt class="docutils literal"><span class="pre">edge_ips</span></tt> as
well, so you can plug it in like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">control_ips</span> <span class="o">=</span> <span class="s2">&quot;${module.your-hosts.control_ips}&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="domain">
<tt class="descname">domain</tt><a class="headerlink" href="#domain" title="Permalink to this definition">¶</a></dt>
<dd><p>The top level domain to add the records to.</p>
<p>Example: <tt class="docutils literal"><span class="pre">mantl.io</span></tt></p>
</dd></dl>

<dl class="data">
<dt id="short_name">
<tt class="descname">short_name</tt><a class="headerlink" href="#short_name" title="Permalink to this definition">¶</a></dt>
<dd><p>The same short name passed into the cloud provider, used to generate
consistent names.</p>
</dd></dl>

<dl class="data">
<dt id="subdomain">
<tt class="descname">subdomain</tt><a class="headerlink" href="#subdomain" title="Permalink to this definition">¶</a></dt>
<dd><p>A path to put between the top-level domain and the generated records. <em>Must</em>
begin with a period.</p>
<p>Example: <tt class="docutils literal"><span class="pre">.apps</span></tt></p>
</dd></dl>

<dl class="data">
<dt id="control_subdomain">
<tt class="descname">control_subdomain</tt><a class="headerlink" href="#control_subdomain" title="Permalink to this definition">¶</a></dt>
<dd><p>The name for the control group (to generate <tt class="docutils literal"><span class="pre">control.yourdomain.com</span></tt>.) By
default, this is <tt class="docutils literal"><span class="pre">control</span></tt>, but you can change it to whatever you&#8217;d like.</p>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/cisco.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Mantl</h2>
    
  </a>
</p>





<p>
<iframe src="http://ghbtns.com/github-btn.html?user=ciscocloud&repo=mantl&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html#general-information-about-mantl-with-ansible">General Information about Mantl with Ansible</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#preparing-to-provision-cloud-hosts">Preparing to provision Cloud Hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#deploying-software-via-ansible">Deploying software via Ansible</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#checking-your-deployment">Checking your deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addons.html">Addons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packer.html">Packer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Licenses</a></li>
</ul>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Cisco Systems, Incorporated.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.2.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.6.3</a>
      
      |
      <a href="../_sources/getting_started/dns.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>