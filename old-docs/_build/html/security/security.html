<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Security &mdash; Mantl 1.0.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Mantl 1.0.3 documentation" href="../index.html" />
    <link rel="up" title="Security" href="index.html" />
    <link rel="next" title="the security-setup script" href="security_setup.html" />
    <link rel="prev" title="Security" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="security_setup.html" title="the security-setup script"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Security"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Mantl 1.0.3 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Security</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="security">
<h1>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Our goal is to make it easy to:</p>
<ul class="simple">
<li>Encrypt restricted and confidential information in transit</li>
<li>Control access to resources</li>
<li>Collect and monitor security-related events</li>
<li>Manage security policies, credentials and certificates</li>
</ul>
<p>Because we are working with different projects, the controls implemented in each
component vary greatly. For example, projects that utilize HTTP tend to provide
support for SSL and HTTP basic authentication while projects in the Hadoop
ecosystem favor Kerberos</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At the current time the infrastructure is not suitable for running
untrusted code or multi-tenant workloads.</p>
</div>
</div>
<div class="section" id="focus-areas">
<h2>Focus Areas<a class="headerlink" href="#focus-areas" title="Permalink to this headline">¶</a></h2>
<p>The security model focuses on three areas:</p>
<ul class="simple">
<li>Provisioning (Ansible, Terraform)</li>
<li>Securing system level components (Consul, Mesos, Marathon, etc.)</li>
<li>Securing Applications that run on the platform</li>
</ul>
<p>The next sections will deal with each area.</p>
<div class="section" id="provisioning">
<h3>Provisioning<a class="headerlink" href="#provisioning" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SSH strict host key checking is turned off for now to make development
against the project easier. When you set up a production instance of
the project, you should change <tt class="docutils literal"><span class="pre">host_key_checking</span></tt> and
<tt class="docutils literal"><span class="pre">record_host_keys</span></tt> in <tt class="docutils literal"><span class="pre">ansible.cfg</span></tt></p>
</div>
<p>Provisioning security involves setting up a secure cloud environment, basic
server security, and securing secrets on the provisioning systems. <a class="reference external" href="https://www.ansible.com">Ansible</a> is the primary provisioning tool with a migration of
cloud provisioning to <a class="reference external" href="https://www.terraform.io">Terraform</a> starting in 0.3.</p>
<p>The following security features are implemented or on the roadmap:</p>
<ul class="simple">
<li>Automate provisioning of SSH key into the cloud host (version 0.1)</li>
<li>Automate the creation of cloud networks (VPC) (version 0.3)</li>
<li>Automate creation of network security groups (version 0.3)</li>
<li>Create sudo administrative users and provide ssh access (version 0.1)</li>
<li>Update Linux kernel &amp; all packages on the node (version 0.1)</li>
<li>Automate creation of passwords/SSL certificates <a class="reference external" href="https://github.com/CiscoCloud/mantl/issues/65">#65</a>
(version 0.2)</li>
<li>Encrypt local secrets using <a class="reference external" href="http://docs.ansible.com/playbooks_vault.html">Ansible Vault</a>. This means that the all
generated tokens, passwords, and SSL keys will be encrypted on the
provisioning system. (future)</li>
</ul>
<p>The following items are currently not on the roadmap:</p>
<ul class="simple">
<li>Setting up LDAP servers</li>
<li>Setting up a Kerberos environment</li>
<li>Encrypting server disks for data at rest.</li>
</ul>
<div class="section" id="credential-generation">
<h4>Credential Generation<a class="headerlink" href="#credential-generation" title="Permalink to this headline">¶</a></h4>
<p>A <tt class="docutils literal"><span class="pre">security-setup</span></tt> script has been created to automate the creation of
credentials. Please refer to <a class="reference internal" href="security_setup.html"><em>the security-setup script</em></a> documentation.</p>
</div>
</div>
<div class="section" id="component-security">
<h3>Component Security<a class="headerlink" href="#component-security" title="Permalink to this headline">¶</a></h3>
<p>This area deals with the securing communication and access on the underlying
components like Consul and Mesos.</p>
<p>As can be seen in the following sections, the components we use provide varying
levels of control. When a component has gaps in security support, we provide a
compensating control.</p>
<div class="section" id="http-authentication-ssl">
<h4>HTTP authentication/SSL<a class="headerlink" href="#http-authentication-ssl" title="Permalink to this headline">¶</a></h4>
<p>HTTP traffic to the management systems is managed via an nginx proxy that
provides basic authentication and ssl termination. For example, consul will be
configured to bind to <tt class="docutils literal"><span class="pre">127.0.0.1:8500</span></tt>, and nginx will bind to the eth0 port
8500 and forward traffic to <tt class="docutils literal"><span class="pre">localhost</span></tt>.</p>
<p>The web credentials will be stored in consul and consul-template will be used to
modify the nginx authentication file. The long term roadmap of the project is to
move more configuration into consul and out of Ansible.</p>
<p>The following steps are taken to secure http on infrastructure components using
an nginx proxy (version 0.2):</p>
<ul class="simple">
<li>Create nginx + consul template docker container (version 0.2)</li>
<li>Create user/password pairs in consul K/V (using Bcrypt) (version 0.2)</li>
<li>Consul-template manages the nginx auth file (version 0.2)</li>
<li>Use generated cert from security script for TLS termination. (version 0.2)</li>
<li>Create default GET policy to allow unauthenticated reads, basic authentication
required for POST, PUT, DELETE. (future version)</li>
</ul>
</div>
<div class="section" id="consul">
<h4>Consul<a class="headerlink" href="#consul" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Consul endpoints are encrypted with Self-signed TLS certificates. A master ACL
token is created as part of the Ansible installation <a class="reference external" href="https://github.com/CiscoCloud/mantl/issues/46">#46</a>
(version 0.2)</li>
<li>Disable consul exec (version 0.2)</li>
<li>The consul API/UI port (8500) is bound to localhost, and an nginx proxy is
used to authenticate POST/PUT/DELETE requests and act as an TLS endpoint.
(version 0.2)</li>
<li><a class="reference external" href="https://www.consul.io/docs/agent/options.html#verify_incoming">Verify incoming TLS connections</a> (version
0.2)</li>
<li><a class="reference external" href="https://www.consul.io/docs/agent/options.html#verify_outgoing">Verify outgoing TLS connections</a> (version
0.2)</li>
<li>Configure an <a class="reference external" href="https://www.consul.io/docs/agent/options.html#acl_datacenter">acl_datacenter</a> (version 0.2)</li>
<li>Keep <a class="reference external" href="https://www.consul.io/docs/agent/options.html#acl_down_policy">acl_down_policy</a> at
&#8220;extend-cache&#8221; (version 0.2)</li>
<li>Create master ACL token (version 0.2)</li>
<li>Create ACL token for agents (version 0.2)</li>
<li>Set default ACL policy to &#8220;allow&#8221; (version 0.2)</li>
</ul>
<p>Future roadmap items:</p>
<ul>
<li><dl class="first docutils">
<dt>Set <a class="reference external" href="https://www.consul.io/docs/agent/options.html#acl_default_policy">acl_default_policy</a> to &#8220;deny&#8221;</dt>
<dd><p class="first last">(version 0.3+)</p>
</dd>
</dl>
</li>
<li><p class="first">Create ACL policies on K/V store and service endpoints</p>
</li>
</ul>
</div>
<div class="section" id="consul-template">
<h4>Consul template<a class="headerlink" href="#consul-template" title="Permalink to this headline">¶</a></h4>
<p>Consul template is used to dynamically configure components based on
Consul Key/Value pairs or items in the Consul catalog. Consul-template
supports the following security options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">auth</span></tt></td>
<td>The basic authentication username (and optional password), separated by a colon. There is no default value.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ssl</span></tt></td>
<td>Use HTTPS while talking to Consul. Requires the Consul server to be configured to serve secure connections. The default value is false.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ssl-verify</span></tt></td>
<td>Verify certificates when connecting via SSL. This requires the use of <tt class="docutils literal"><span class="pre">-ssl</span></tt>. The default value is true.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">token</span></tt></td>
<td>The Consul API token. There is no default value.</td>
</tr>
</tbody>
</table>
<p>Consul template is used across the environment. The following settings
are generally used:</p>
<ul>
<li><dl class="first docutils">
<dt>the <tt class="docutils literal"><span class="pre">auth</span></tt> parameter is set to a username:password that mirrors the nginx</dt>
<dd><p class="first last">proxy configuration</p>
</dd>
</dl>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">ssl</span></tt> is set to true</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">ssl-verify</span></tt> is set to <tt class="docutils literal"><span class="pre">false</span></tt> if Self-signed certificates are used</p>
</li>
</ul>
</div>
</div>
<div class="section" id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h3>
<p>The project is currently using the default Docker configuration for CentOS.
Docker 1.8 is the minimum version installed.</p>
<ul class="simple">
<li>ReST HTTP port is disabled</li>
</ul>
</div>
<div class="section" id="marathon">
<h3>Marathon<a class="headerlink" href="#marathon" title="Permalink to this headline">¶</a></h3>
<p>Marathon supports both basic http authentication and TLS via the Java keystore,
however we use a different method by placing an authenticating proxy in front of
the instance, using the same credentials as for the Mesos and Consul
administrative accounts.</p>
<p>Marathon does not support Zookeeper authentication, so the zookeeper znode must
have world access.</p>
<p>The following controls will be implemented:</p>
<ul class="simple">
<li>Bind Marathon to locahost (version 0.2+)</li>
<li>Place nginx authenticating/SSL proxy in front of Marathon (version 0.2)</li>
<li>Create a dynamic firewall on each Marathon host that uses consul-template to
only allow connections from other Marathon nodes. (version 0.2)</li>
</ul>
<p>References:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mesosphere/marathon/blob/master/docs/docs/ssl-basic-access-authentication.md">SSL and Basic Access
Authentication</a></li>
<li><a class="reference external" href="https://github.com/mesosphere/marathon/issues/1336">Support Zookeeper Authentication</a></li>
</ul>
</div>
<div class="section" id="mesos">
<h3>Mesos<a class="headerlink" href="#mesos" title="Permalink to this headline">¶</a></h3>
<p>Support for authentication and encryption is limited to framework authentication
in the current 0.21 and earlier versions of Mesos, but better support for
features like SSL is on the roadmap.</p>
<p>Currently Mesos supports basic CRAM-MD5 authentication, with support for
Kerberos on the roadmap <a class="reference external" href="https://issues.apache.org/jira/browse/MESOS-418">MESOS-418</a></p>
<p><a class="reference external" href="http://mesos.apache.org/documentation/latest/authorization/">Mesos Authorization</a> allows control
of the following actions: <tt class="docutils literal"><span class="pre">register_frameworks</span></tt>, <tt class="docutils literal"><span class="pre">shutdown_frameworks</span></tt>,
<tt class="docutils literal"><span class="pre">run_tasks</span></tt>. Support for Mesos authorization is still being reviewed.</p>
<p>The following steps are taken to secure mesos if security is enabled:</p>
<ul class="simple">
<li>On the leader nodes, the <tt class="docutils literal"><span class="pre">--authenticate</span></tt> flag is set</li>
<li>On the leader nodes, the <tt class="docutils literal"><span class="pre">--authenticate_slaves</span></tt> flag is set</li>
<li>A credential file is created and the <tt class="docutils literal"><span class="pre">--credential=/path</span></tt> is set on leaders
and followers (version 0.2)</li>
<li>Mesos nodes connect to zookeeper with a <tt class="docutils literal"><span class="pre">username:password</span></tt> (version 0.2)</li>
<li>Zookeeper ACL created on the /mesos znode: world read, mesos full access
(version 0.2)</li>
</ul>
<p>Future security items:</p>
<ul class="simple">
<li>SSL support for Mesos is scheduled to be included in version 0.23:</li>
<li><a class="reference external" href="https://issues.apache.org/jira/browse/MESOS-910">MESOS-910</a></li>
</ul>
<p><a class="reference external" href="https://issues.apache.org/jira/browse/MESOS-907">Kerberos support in
Mesos</a> is scheduled
for a future release.</p>
<p>References:</p>
<ul class="simple">
<li><a class="reference external" href="http://mesos.apache.org/blog/framework-authentication-in-apache-mesos-0-15-0/">Framework Authentication in Apache Mesos 0.15.0</a></li>
</ul>
</div>
<div class="section" id="zookeeper">
<h3>Zookeeper<a class="headerlink" href="#zookeeper" title="Permalink to this headline">¶</a></h3>
<p>The main recommendation for securing Zookeeper is to use Kerberos, which
is currently out of scope for the project.</p>
<p>Zookeeper supports <a class="reference external" href="http://zookeeper.apache.org/doc/r3.1.2/zookeeperProgrammers.html#sc_ZooKeeperAccessControl">ACLs</a>
on Znodes, but ACLs are not recursive.</p>
<p>SSL endpoints are supported via Netty, but the C client does not yet have SSL
support <a class="reference external" href="https://issues.apache.org/jira/browse/ZOOKEEPER-2125">ZOOKEEPER-2125</a> <a class="reference external" href="https://issues.apache.org/jira/browse/ZOOKEEPER-2122">ZOOKEEPER-2122</a>.</p>
<p>Compensating controls:</p>
<ul>
<li><p class="first">We won&#8217;t store any restricted data within Zookeeper (under review)</p>
</li>
<li><p class="first">Implement ACLs and Authentication on the <tt class="docutils literal"><span class="pre">/mesos</span></tt> znode using user digest.
(version 0.2)</p>
</li>
<li><p class="first">Implement ACLs and Authentication on the <tt class="docutils literal"><span class="pre">/marathon</span></tt> znode using user
digest. (version 0.3+, pending support for Marathon zk authentication))</p>
</li>
<li><dl class="first docutils">
<dt>Provide Stunnel encryption for Zookeeper Peer-to-Peer communication (version</dt>
<dd><p class="first last">0.3+)</p>
</dd>
</dl>
</li>
<li><p class="first">Develop dynamic firewall using consul template on Zookeeper ports (version
0.3)</p>
</li>
<li><p class="first">Update Marathon configuration to use zk user:password (future version)</p>
</li>
<li><p class="first">Update Mesos configuration to use zk user:password (version 0.2)</p>
</li>
</ul>
<p>References:</p>
<ul class="simple">
<li><a class="reference external" href="https://ihong5.wordpress.com/2014/07/24/apache-zookeeper-setting-acl-in-zookeeper-client/">Setting ACLs &amp; Auth in
zookeeper</a></li>
</ul>
</div>
</div>
<div class="section" id="longer-term-goals">
<h2>Longer-term goals<a class="headerlink" href="#longer-term-goals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="kerberos">
<h3>Kerberos<a class="headerlink" href="#kerberos" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Integrate Kerberos authentication into supported components: Zookeeper, Mesos,
HDFS, Kafka, etc.</li>
</ul>
</div>
<div class="section" id="application-ssl-support">
<h3>Application SSL support<a class="headerlink" href="#application-ssl-support" title="Permalink to this headline">¶</a></h3>
<p>Enable developers to secure their applications with SSL.</p>
<p>Phase I: SSL support for wildcard DNS domains.</p>
<p>Phase II: SSL support for custom DNS domains</p>
<p>References:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-implement-ssl-termination-with-haproxy-on-ubuntu-14-04">HAProxy SSL termination</a></li>
<li><a class="reference external" href="https://devcenter.heroku.com/articles/ssl-endpoint">Heroku SSL Endpoint</a></li>
<li><a class="reference external" href="https://github.com/deis/deis/pull/2911">Deis SSL support for custom domains</a></li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/cisco.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Mantl</h2>
    
  </a>
</p>





<p>
<iframe src="http://ghbtns.com/github-btn.html?user=ciscocloud&repo=mantl&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html#general-information-about-mantl-with-ansible">General Information about Mantl with Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addons.html">Addons</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Security</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_setup.html">the security-setup script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packer.html">Packer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Licenses</a></li>
</ul>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Cisco Systems, Incorporated.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.2.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.6.3</a>
      
      |
      <a href="../_sources/security/security.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>